<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="chat.api.chat.mapper.ChatMapper">
    <resultMap id="chatRoomMap" type="chatRoomDto">
        <id column="roomId" property="roomId"/>
        <result column="roomName" property="roomName"/>
        <collection property="users" column="roomId" select="selectUsers" />
    </resultMap>

    <select id="selectAllRoomsByUserId" parameterType="Long" resultMap="chatRoomMap">
        SELECT room.room_id AS roomId
               , room.name AS roomName
          FROM chat_group g
         INNER JOIN chat_room room
            ON g.room_id = room.room_id
         WHERE g.user_id = #{userId}
    </select>

    <select id="selectUsers" parameterType="Long" resultType="userDto">
        SELECT u.email AS email
               , u.name AS name
          FROM chat_group g
         INNER JOIN users u
            ON g.user_id = u.user_id
         WHERE g.room_id = #{roomId}
    </select>
</mapper>